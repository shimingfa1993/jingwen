<template>
  <div v-if="isVisible" class="love-games-overlay">
    <div class="games-container">
      <div class="game-header">
        <h2>❤️ 十三年·十三个爱的小游戏 ❤️</h2>
        <p>亲爱的静文，为你准备了13个特别的小游戏，完成它们解锁我们的美好回忆～</p>
        <div class="progress-bar">
          <div class="progress" :style="{width: (completedGames.length / 13 * 100) + '%'}"></div>
        </div>
        <span class="progress-text">{{ completedGames.length }}/13</span>
        <div class="debug-controls" v-if="getGameAttempts(currentGame) > getMaxAttempts(currentGame)">
          <button @click="forceCompleteCurrentGame" class="emergency-btn">
            🚑 强制完成当前游戏
          </button>
        </div>
      </div>

      <!-- 游戏1: 数字闪烁 -->
      <div v-if="currentGame === 1" class="game-content">
        <h3>🎯 第一关：幸运数字</h3>
        <p>仔细看数字闪烁，当看到66时点击停止！</p>
        <div class="number-flash">
          <div class="flash-container" :class="{active: isFlashing}">
            <div class="number" 
                 :class="{
                   blurry: isBlurry && !completedGames.includes(1),
                   clear: (!isBlurry && isFlashing) || completedGames.includes(1),
                   hidden: !isFlashing && !completedGames.includes(1)
                 }"
                 :style="{
                   opacity: completedGames.includes(1) ? 1 : numberOpacity,
                   transform: completedGames.includes(1) ? 'scale(1)' : `scale(${numberScale}) translateY(${numberShake}px)`
                 }">
                             {{ completedGames.includes(1) ? 66 : currentNumber }}
            </div>
          </div>
          <button @click="isFlashing ? stopFlash() : startNumberFlash()" 
                  class="game-btn"
                  :disabled="completedGames.includes(1)">
            {{ completedGames.includes(1) ? '已完成' : (isFlashing ? '停止' : '开始') }}
          </button>
          <div v-if="completedGames.includes(1)" class="success-hint">
            ✅ 游戏已完成！您成功找到了66这个幸运数字！
          </div>
          <div v-else-if="gameAttempts[1] > 0" class="attempt-hint">
            尝试次数: {{ gameAttempts[1] }}/{{ getMaxAttempts(1) }}
          </div>
          <div v-if="!completedGames.includes(1)" class="game-hint">
            💡 提示：数字会在清晰和模糊之间变化，抓住时机！
          </div>
        </div>
      </div>

      <!-- 游戏2: 日期拼图 -->
      <div v-if="currentGame === 2" class="game-content">
        <h3>💝 第二关：日期拼图</h3>
        <p>将数字拖拽到正确位置，拼成我们的纪念日期：0528！</p>
        <div class="puzzle-area">
          <div class="puzzle-target">
            <div v-for="(targetNum, index) in puzzleTargetNumbers" :key="index" 
                 class="puzzle-slot" 
                 :data-slot="index"
                 @dragover.prevent
                 @drop="dropPuzzlePiece($event, index)">
              <div v-if="puzzlePieces[index].placed" class="puzzle-piece placed" :data-piece="puzzlePieces[index].number">
                {{ puzzlePieces[index].number }}
              </div>
              <div v-else class="slot-hint">{{ targetNum }}</div>
            </div>
          </div>
          <div class="puzzle-pieces">
            <div v-for="piece in availablePuzzlePieces" :key="piece" 
                 class="puzzle-piece" 
                 :data-piece="piece"
                 draggable="true"
                 @dragstart="startPuzzleDrag"
                 @dragend="endPuzzleDrag">
              {{ piece }}
            </div>
          </div>
          <div v-if="gameAttempts[2] > 0" class="attempt-hint">
            尝试次数: {{ gameAttempts[2] }}/{{ getMaxAttempts(2) }}
          </div>
          <div class="puzzle-hint">
            提示：将数字拖拽到对应的位置（0→第1位, 5→第2位, 2→第3位, 8→第4位）
          </div>
        </div>
      </div>

      <!-- 游戏3: 情话配对 -->
      <div v-if="currentGame === 3" class="game-content">
        <h3>💌 第三关：情话配对</h3>
        <p>将情话的上下句正确配对！</p>
        <div class="love-quotes-game">
          <div class="quotes-left">
            <div v-for="(quote, index) in loveQuotes" :key="'left-'+index" 
                 class="quote-item" 
                 :class="{selected: selectedLeft === index, matched: quote.matched}"
                 @click="selectLeft(index)">
              {{ quote.first }}
            </div>
          </div>
          <div class="quotes-right">
            <div v-for="(quote, index) in shuffledSecondParts" :key="'right-'+index" 
                 class="quote-item" 
                 :class="{selected: selectedRight === index, matched: secondPartsMatched[index]}"
                 @click="selectRight(index)">
              {{ quote.second }}
            </div>
          </div>
        </div>
      </div>

      <!-- 游戏4: 日期记忆 -->
      <div v-if="currentGame === 4" class="game-content">
        <h3>📅 第四关：重要日期</h3>
        <p>成为文哥忠诚的小发子的年份！</p>
        <div class="date-game">
          <div class="date-options">
            <button v-for="year in [2010, 2011, 2012, 2013]" :key="year" 
                    class="date-btn" 
                    :class="{ correct: year === correctYear && completedGames.includes(4) }"
                    :disabled="completedGames.includes(4)"
                    @click="selectYear(year)">
              {{ year }}年
            </button>
          </div>
          <div v-if="gameAttempts[4] > 0 && !completedGames.includes(4)" class="attempt-hint">
            尝试次数: {{ gameAttempts[4] }}/{{ getMaxAttempts(4) }}
          </div>
          <div v-if="completedGames.includes(4)" class="success-hint">
            ✅ 游戏已完成！正确答案是2012年
          </div>
        </div>
      </div>

      <!-- 游戏5: 照片记忆 -->
      <div v-if="currentGame === 5" class="game-content">
        <h3>📷 第五关：美好回忆</h3>
        <p>点击翻开卡片，找到两张相同的照片！</p>
        <div class="memory-game">
          <div v-for="(card, index) in memoryCards" :key="index" 
               class="memory-card" 
               :class="{flipped: card.flipped, matched: card.matched}"
               @click="flipCard(index)">
            <div class="card-front">❤️</div>
            <div class="card-back">{{ card.emoji }}</div>
          </div>
        </div>
      </div>

      <!-- 游戏6: 字母游戏 -->
      <div v-if="currentGame === 6" class="game-content">
        <h3>🔤 第六关：爱的密码</h3>
        <p>按正确顺序点击字母，拼出"LOVE"！</p>
        <div class="letter-game">
          <div class="target-word">{{ targetWord }}</div>
          <div class="letter-buttons">
            <button v-for="letter in shuffledLetters" :key="letter" 
                    class="letter-btn" 
                    :disabled="selectedLetters.includes(letter)"
                    @click="selectLetter(letter)">
              {{ letter }}
            </button>
          </div>
          <div class="selected-letters">{{ selectedLetters.join('') }}</div>
          <div v-if="gameAttempts[6] > 0" class="attempt-hint">
            尝试次数: {{ gameAttempts[6] }}/{{ getMaxAttempts(6) }}
          </div>
        </div>
      </div>

      <!-- 游戏7: 颜色记忆 -->
      <div v-if="currentGame === 7" class="game-content">
        <h3>🌈 第七关：彩虹记忆</h3>
        <p>记住颜色闪烁的顺序，然后按相同顺序点击！</p>
        <div class="color-game">
          <div class="color-buttons">
            <button v-for="(color, index) in colors" :key="index" 
                    class="color-btn" 
                    :style="{backgroundColor: color}"
                    :class="{active: activeColor === index}"
                    @click="clickColor(index)"
                    :disabled="!gameStarted || sequenceShowing"></button>
          </div>
          <button v-if="!sequenceShowing && !gameStarted" @click="startColorGame" class="game-btn">开始</button>
          <div v-if="sequenceShowing" class="status-hint">请记住颜色闪烁的顺序...</div>
          <div v-if="gameStarted && !sequenceShowing" class="status-hint">
            现在请按刚才的顺序点击颜色！({{ playerSequence.length }}/{{ colorSequence.length }})
          </div>
        </div>
      </div>

      <!-- 游戏8: 时间轴排序 -->
      <div v-if="currentGame === 8" class="game-content">
        <h3>⏰ 第八关：时光排序</h3>
        <p>将我们的重要时刻按时间顺序排列！</p>
        <div class="timeline-game">
          <div class="timeline-events">
            <div v-for="(event, index) in timelineEvents" :key="index" 
                 class="timeline-event" 
                 draggable="true"
                 @dragstart="startTimelineDrag(index)"
                 @dragover.prevent
                 @drop="dropTimelineEvent(index)">
              {{ event.title }}
            </div>
          </div>
          <button @click="checkTimelineOrder" class="game-btn">检查顺序</button>
        </div>
      </div>

      <!-- 游戏9: 找茬游戏 -->
      <div v-if="currentGame === 9" class="game-content">
        <h3>🔍 第九关：火眼金睛</h3>
        <p>找出两张图中的3个不同之处！点击红圈找出不同点</p>
        <div class="spot-difference-game">
          <div class="image-pair">
            <div class="game-image left-image">
              <!-- 左图的内容 -->
              <div class="scene-content">
                <div class="sun">☀️</div>
                <div class="tree">🌲</div>
                <div class="house">🏠</div>
                <div class="flower">🌸</div>
                <div class="bird">🐦</div>
                <div class="cloud">☁️</div>
              </div>
              <!-- 不同点标记 -->
              <div v-for="diff in differences" :key="'left-'+diff.id" 
                   class="difference-spot" 
                   :style="{top: diff.y + 'px', left: diff.x + 'px'}"
                   :class="{found: diff.found}"
                   @click="foundDifference(diff.id)"></div>
            </div>
            <div class="game-image right-image">
              <!-- 右图的内容（有不同） -->
              <div class="scene-content">
                <div class="sun">🌙</div><!-- 不同1: 太阳vs月亮 -->
                <div class="tree">🌲</div>
                <div class="house">🏠</div>
                <div class="flower">🌸</div>
                <div class="bird" style="display: none;">🐦</div><!-- 不同2: 鸟消失了 -->
                <div class="cloud">☁️</div>
                <div class="star">⭐</div><!-- 不同3: 多了一颗星星 -->
              </div>
              <!-- 不同点标记 -->
              <div v-for="diff in differences" :key="'right-'+diff.id" 
                   class="difference-spot" 
                   :style="{top: diff.y + 'px', left: diff.x + 'px'}"
                   :class="{found: diff.found}"
                   @click="foundDifference(diff.id)"></div>
            </div>
          </div>
          <div class="difference-progress">
            已找到 {{ foundDifferencesCount }}/3 个不同点
          </div>
        </div>
      </div>

      <!-- 游戏10: 密码锁 -->
      <div v-if="currentGame === 10" class="game-content">
        <h3>🔐 第十关：爱的密码</h3>
        <p>输入我想对静文说的得数字（三位数字）！</p>
        <div v-if="!completedGames.includes(10)" class="password-debug">
          当前输入：{{ passwordInput.join('') || '无' }}
        </div>
        <div class="password-game">
          <div class="password-display">
            <span v-for="(digit, index) in passwordInput" :key="index" class="password-digit">
              {{ digit || '_' }}
            </span>
          </div>
          <div class="number-pad">
            <button v-for="num in [1,2,3,4,5,6,7,8,9,0]" :key="num" 
                    class="number-btn" 
                    :disabled="completedGames.includes(10)"
                    @click="inputPassword(num)">
              {{ num }}
            </button>
            <button class="clear-btn" 
                    :disabled="completedGames.includes(10)"
                    @click="clearPassword">清除</button>
          </div>
          <div v-if="completedGames.includes(10)" class="success-hint">
            ✅ 游戏已完成！密码正确：520！
          </div>
          <div v-else-if="gameAttempts[10] > 0" class="attempt-hint">
            尝试次数: {{ gameAttempts[10] }}/{{ getMaxAttempts(10) }}
          </div>
        </div>
      </div>

      <!-- 游戏11: 音乐节拍 -->
      <div v-if="currentGame === 11" class="game-content">
        <h3>🎵 第十一关：爱的节拍</h3>
        <p>跟着节拍点击，完成13下！</p>
        <div class="rhythm-game">
          <div class="beat-circle" :class="{active: beatActive}"></div>
          <div class="beat-counter">{{ beatCount }}/13</div>
          <button @click="startRhythmGame" v-if="!rhythmGameStarted" class="game-btn">开始</button>
        </div>
      </div>

      <!-- 游戏12: 星座连线 -->
      <div v-if="currentGame === 12" class="game-content">
        <h3>⭐ 第十二关：星空爱语</h3>
        <p>点击所有星星，让它们发光组成爱心形状！</p>
        <div class="constellation-game">
          <svg class="star-canvas" width="300" height="200">
            <circle v-for="(star, index) in stars" :key="index" 
                    :cx="star.x" :cy="star.y" r="12" 
                    class="star" 
                    :class="{connected: star.connected}"
                    :fill="star.connected ? '#ffd700' : '#ddd'"
                    stroke="#ff69b4" 
                    stroke-width="2"
                    style="cursor: pointer;"
                    @click="clickStar(index)"></circle>
            <path v-for="(line, index) in starLines" :key="index" 
                  :d="line" stroke="#ff69b4" stroke-width="2" fill="none"></path>
          </svg>
          <div class="star-progress">{{ connectedStarsCount }}/{{ stars.length }} 颗星星已点亮</div>
        </div>
      </div>

      <!-- 游戏13: 最终告白 -->
      <div v-if="currentGame === 13" class="game-content">
        <h3>💖 第十三关：最终告白</h3>
        <p>这份礼物满意吗？</p>
        <div class="confession-game">
          <input v-model="confessionInput" 
                 class="confession-input" 
                 placeholder="请输入您的想法..." 
                 :disabled="completedGames.includes(13)"
                 @keyup.enter="checkConfession">
          <button @click="checkConfession" 
                  class="game-btn"
                  :disabled="completedGames.includes(13)">
            确认
          </button>
          <div v-if="completedGames.includes(13)" class="success-hint">
            ✅ 谢谢您的回答！礼物已送达！
          </div>
          <div v-else-if="gameAttempts[13] > 0" class="attempt-hint">
            尝试次数: {{ gameAttempts[13] }}/{{ getMaxAttempts(13) }}
          </div>
        </div>
      </div>

      <!-- 游戏完成庆祝 -->
      <div v-if="allGamesCompleted" class="completion-celebration">
        <h2>🎉 恭喜！所有游戏完成！🎉</h2>
        <p>静文，这十三个游戏代表我们十三年的美好时光</p>
        <p>每一关都充满了我对你的爱意</p>
        <p>这份特别的礼物，希望能给你带来快乐！</p>
        
        <!-- 转账功能 -->
        <div class="transfer-section">
          <h3>💰 特别的小惊喜</h3>
          <p>作为通关奖励，给你准备了一个小红包！</p>
          <div class="transfer-amount">¥2400</div>
          <div class="transfer-buttons">
            <button @click="openAlipayTransfer" class="transfer-btn alipay-btn">
              💙 支付宝转账
            </button>
            <button @click="showTransferInfo" class="transfer-btn info-btn">
              📋 查看转账信息
            </button>
          </div>
          
          <!-- 转账信息显示 -->
          <div v-if="showTransferDetails" class="transfer-details">
            <h4>💡 转账信息</h4>
            <div class="transfer-info">
              <p><strong>收款人：</strong>刘静文</p>
              <p><strong>金额：</strong>¥2400.00</p>
              <p><strong>备注：</strong>十三年爱情游戏通关奖励💕</p>
            </div>
            <div class="transfer-actions">
              <button @click="copyTransferInfo" class="transfer-btn copy-btn">
                📋 复制转账信息
              </button>
              <div class="transfer-notes">
                <p>💡 转账步骤：</p>
                <p>1. 点击"支付宝转账"按钮（手机端）</p>
                <p>2. 或复制信息手动转账</p>
                <p>3. 备注：十三年爱情游戏通关奖励💕</p>
              </div>
            </div>
          </div>
        </div>
        
        <div class="celebration-hearts">
          <span v-for="i in 13" :key="i" class="floating-heart">💖</span>
        </div>
      </div>

      <div class="game-controls">
        <button v-if="!allGamesCompleted" @click="nextGame" 
                :disabled="!currentGameCompleted" 
                class="next-btn">
          {{ currentGameCompleted ? '下一关' : '完成当前游戏' }}
        </button>
        <button @click="closeGames" class="close-btn">关闭</button>
      </div>
    </div>
  </div>
</template>

<style scoped>
.game-image {
  position: relative;
  width: 200px;
  height: 150px;
  border: 2px solid #ff69b4;
  border-radius: 10px;
  background: linear-gradient(135deg, #87CEEB 0%, #98FB98 100%);
  margin: 0 10px;
  overflow: hidden;
}

.scene-content {
  position: relative;
  width: 100%;
  height: 100%;
}

.scene-content > div {
  position: absolute;
  font-size: 20px;
}

.sun, .moon { top: 10px; left: 20px; }
.tree { top: 50px; left: 30px; }
.house { top: 80px; left: 80px; }
.flower { top: 90px; left: 20px; }
.bird { top: 40px; left: 100px; }
.cloud { top: 15px; left: 120px; }
.star { top: 25px; left: 150px; }

.difference-spot {
  position: absolute;
  width: 25px;
  height: 25px;
  border: 3px solid #ff0000;
  border-radius: 50%;
  background: rgba(255, 0, 0, 0.2);
  cursor: pointer;
  animation: pulse 1.5s infinite;
}

.difference-spot.found {
  background: rgba(0, 255, 0, 0.3);
  border-color: #00ff00;
  animation: none;
}

@keyframes pulse {
  0% { transform: scale(1); opacity: 0.7; }
  50% { transform: scale(1.1); opacity: 1; }
  100% { transform: scale(1); opacity: 0.7; }
}

.image-pair {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 20px;
  margin: 20px 0;
}

.difference-progress {
  text-align: center;
  font-size: 16px;
  font-weight: bold;
  color: #ff69b4;
  margin-top: 15px;
}

.spot-difference-game {
  padding: 20px;
}

/* 第一关数字闪烁游戏样式 */
.number-flash {
  text-align: center;
  padding: 20px;
}

.flash-container {
  width: 150px;
  height: 150px;
  margin: 20px auto;
  border: 3px solid #ff69b4;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: radial-gradient(circle, #fff 0%, #ffe6f0 100%);
  position: relative;
  overflow: hidden;
}

.flash-container.active {
  box-shadow: 0 0 20px rgba(255, 105, 180, 0.5);
  animation: glow 2s infinite;
}

.number {
  font-size: 48px;
  font-weight: bold;
  color: #ff1493;
  transition: all 0.3s ease;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
}

.number.blurry {
  filter: blur(8px);
  text-shadow: 0 0 10px #ff1493;
}

.number.clear {
  filter: blur(0px);
  text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.number.hidden {
  opacity: 0;
}

.game-hint {
  margin-top: 15px;
  padding: 10px;
  background: rgba(255, 105, 180, 0.1);
  border-radius: 10px;
  font-size: 14px;
  color: #666;
}

@keyframes glow {
  0%, 100% { box-shadow: 0 0 20px rgba(255, 105, 180, 0.5); }
  50% { box-shadow: 0 0 30px rgba(255, 105, 180, 0.8); }
}
</style>

<script>
export default {
  name: 'LoveGames',
  data() {
    return {
      isVisible: false,
      currentGame: 1,
      completedGames: [],
      gameAttempts: {}, // 记录每个游戏的尝试次数
      
      // 游戏1: 数字闪烁
      currentNumber: 0,
      isFlashing: false,
      isBlurry: false,
      numberOpacity: 1,
      numberScale: 1,
      numberShake: 0,
      flashInterval: null,
      effectInterval: null,
      
      // 游戏2: 日期拼图
      puzzlePieces: [
        {placed: false, number: null},
        {placed: false, number: null},
        {placed: false, number: null},
        {placed: false, number: null}
      ],
      puzzleTargetNumbers: [0, 5, 2, 8], // 目标数字顺序
      shuffledPieces: [8, 2, 0, 5], // 随机打乱的数字
      
      // 游戏3: 情话配对
      loveQuotes: [
        {first: "山有木兮木有枝", second: "心悦君兮君不知", matched: false},
        {first: "愿得一心人", second: "白头不相离", matched: false},
        {first: "执子之手", second: "与子偕老", matched: false}
      ],
      shuffledSecondParts: [],
      selectedLeft: -1,
      selectedRight: -1,
      secondPartsMatched: [false, false, false],
      
      // 游戏4: 日期记忆
      correctYear: 2012,
      
      // 游戏5: 照片记忆
      memoryCards: [],
      flippedCards: [],
      
      // 游戏6: 字母游戏
      targetWord: "LOVE",
      shuffledLetters: ['E', 'V', 'O', 'L'],
      selectedLetters: [],
      
      // 游戏7: 颜色记忆
      colors: ['#ff4757', '#2ed573', '#1e90ff', '#ffa502'],
      colorSequence: [],
      playerSequence: [],
      activeColor: -1,
      sequenceShowing: false,
      gameStarted: false,
      
      // 游戏8: 时间轴
      timelineEvents: [
        {title: "2012年相识", order: 1},
        {title: "2013年在一起", order: 2},
        {title: "2015年异地恋", order: 3},
        {title: "2020年决定转型", order: 4}
      ],
      draggedEventIndex: -1,
      
      // 游戏9: 找茬
      differences: [
        {id: 1, x: 20, y: 20, found: false, description: "太阳变月亮"},
        {id: 2, x: 100, y: 60, found: false, description: "小鸟消失了"},
        {id: 3, x: 150, y: 30, found: false, description: "多了一颗星星"}
      ],
      
      // 游戏10: 密码锁
      passwordInput: ['', '', ''],
      correctPassword: ['5', '2', '0'], // 我爱你
      
      // 游戏11: 音乐节拍
      beatCount: 0,
      beatActive: false,
      rhythmGameStarted: false,
      beatInterval: null,
      
      // 游戏12: 星座连线
      stars: [
        {x: 100, y: 100, connected: false},
        {x: 150, y: 80, connected: false},
        {x: 200, y: 100, connected: false},
        {x: 125, y: 150, connected: false},
        {x: 175, y: 150, connected: false}
      ],
      starLines: [],
      currentPath: '',
      connectingStars: false,
      startPoint: {x: 0, y: 0},
      
      // 游戏13: 最终告白
          confessionInput: '',
    correctConfession: '静文我爱你',
    
    // 转账相关
    showTransferDetails: false,
    transferAmount: 2400,
    recipientName: '刘静文',
    recipientAccount: '请填入女友的支付宝账号', // 需要填入实际的支付宝账号
    recipientAlipayId: '' // 支付宝用户ID
    }
  },
  computed: {
    currentGameCompleted() {
      return this.completedGames.includes(this.currentGame)
    },
    allGamesCompleted() {
      return this.completedGames.length === 13
    },
    availablePuzzlePieces() {
      return this.shuffledPieces.filter(piece => {
        // 检查这个数字是否还没有被放置
        return !this.puzzlePieces.some(p => p.placed && p.number === piece)
      })
    },
    
    connectedStarsCount() {
      return this.stars.filter(star => star.connected).length
    },
    
    foundDifferencesCount() {
      return this.differences.filter(diff => diff.found).length
    }
  },
  mounted() {
    this.initializeGames()
  },
  methods: {
    getMaxAttempts(gameNumber) {
      // 前5个游戏最多3次尝试，后8个游戏最多2次尝试
      return gameNumber <= 5 ? 3 : 2
    },
    
    getGameAttempts(gameNumber) {
      return this.gameAttempts[gameNumber] || 0
    },
    
    incrementAttempts(gameNumber) {
      if (!this.gameAttempts[gameNumber]) {
        this.gameAttempts[gameNumber] = 0
      }
      this.gameAttempts[gameNumber]++
    },
    
    shouldAutoPass(gameNumber) {
      const attempts = this.getGameAttempts(gameNumber)
      const maxAttempts = this.getMaxAttempts(gameNumber)
      return attempts >= maxAttempts // 当尝试次数达到最大次数时就自动通过
    },
    show() {
      this.isVisible = true
      // 重置第一关状态，不自动开始
      this.isFlashing = false
      this.isBlurry = false
      this.numberOpacity = 1
      this.numberScale = 1
      this.numberShake = 0
      this.currentNumber = 0
      if (this.flashInterval) clearInterval(this.flashInterval)
      if (this.effectInterval) clearInterval(this.effectInterval)
    },
    
    closeGames() {
      this.isVisible = false
      this.$emit('close')
    },
    
    initializeGames() {
      // 初始化游戏2的拼图
      this.shufflePuzzlePieces()
      
      // 初始化游戏3的情话配对
      this.shuffleQuotes()
      
      // 初始化游戏5的记忆卡片
      this.initMemoryCards()
      
      // 初始化游戏8的时间轴
      this.shuffleTimelineEvents()
    },
    
    // 游戏1: 数字闪烁
    startNumberFlash() {
      if (this.currentGame === 1 && !this.completedGames.includes(1)) {
        this.isFlashing = true
        this.currentNumber = 0
        
        const currentAttempts = this.getGameAttempts(1)
        let targetNumbers = []
        
        // 根据尝试次数调整数字出现策略
        if (currentAttempts === 0) {
          // 第一次：66出现在6-10秒之间
          targetNumbers = [66, 15, 22, 8, 66, 18, 66, 25, 12]
        } else if (currentAttempts === 1) {
          // 第二次：66出现更频繁
          targetNumbers = [66, 12, 66, 7, 66, 20, 66, 66, 16]
        } else {
          // 第三次：66出现非常频繁，几乎每隔一个数字就是66
          targetNumbers = [66, 5, 66, 9, 66, 13, 66, 2, 66, 66]
        }
        
        let numberIndex = 0
        
        // 数字变化间隔
        this.flashInterval = setInterval(() => {
          if (currentAttempts >= 2) {
            // 第三次尝试时，大幅增加66的出现概率
            this.currentNumber = Math.random() > 0.3 ? 66 : Math.floor(Math.random() * 99) + 1
          } else {
            // 前两次使用预设的数字序列
            this.currentNumber = targetNumbers[numberIndex % targetNumbers.length]
            numberIndex++
          }
        }, 800) // 稍微放慢速度，让用户更容易看清
        
        // 视觉效果间隔
        this.effectInterval = setInterval(() => {
          // 第三次尝试时减少视觉干扰
          if (currentAttempts >= 2) {
            this.isBlurry = Math.random() > 0.7 // 减少模糊
            this.numberOpacity = 0.7 + Math.random() * 0.3 // 提高最低透明度
            this.numberScale = 0.9 + Math.random() * 0.2 // 减少缩放幅度
            this.numberShake = (Math.random() - 0.5) * 4 // 减少抖动
          } else {
            this.isBlurry = Math.random() > 0.5
            this.numberOpacity = 0.4 + Math.random() * 0.6
            this.numberScale = 0.8 + Math.random() * 0.4
            this.numberShake = (Math.random() - 0.5) * 8
          }
        }, 300) // 稍微放慢效果变化
      }
    },
    
    stopFlash() {
      this.isFlashing = false
      clearInterval(this.flashInterval)
      clearInterval(this.effectInterval)
      
      // 重置视觉效果
      this.isBlurry = false
      this.numberOpacity = 1
      this.numberScale = 1
      this.numberShake = 0
      
      const currentAttempts = this.getGameAttempts(1)
      
      if (this.currentNumber === 66) {
        this.completeGame(1, "太棒了！66是我们的幸运数字！💕")
      } else {
        this.incrementAttempts(1)
        
        let encourageMessage = ""
        if (currentAttempts === 0) {
          encourageMessage = `数字是${this.currentNumber}，不是66哦！别着急，再试一次～`
        } else if (currentAttempts === 1) {
          encourageMessage = `数字是${this.currentNumber}，差一点点！再试一次～`
        } else {
          encourageMessage = `数字是${this.currentNumber}，最后一次机会！仔细看～`
        }
        
        alert(encourageMessage)
        setTimeout(() => {
          this.startNumberFlash()
        }, 1500)
      }
    },
    
    // 游戏2: 拼图相关方法
    shufflePuzzlePieces() {
      // 重新洗牌，确保拼图块不是按顺序排列
      this.shuffledPieces = [0, 5, 2, 8].sort(() => Math.random() - 0.5)
    },
    
    startPuzzleDrag(event) {
      event.dataTransfer.setData('text/plain', event.target.dataset.piece)
    },
    
    endPuzzleDrag() {
      // 拖拽结束
    },
    
    dropPuzzlePiece(event, slotIndex) {
      event.preventDefault()
      const pieceNumber = parseInt(event.dataTransfer.getData('text/plain'))
      const targetNumber = this.puzzleTargetNumbers[slotIndex]
      
      // 检查是否拖拽到正确位置
      if (pieceNumber === targetNumber) {
        this.puzzlePieces[slotIndex].placed = true
        this.puzzlePieces[slotIndex].number = pieceNumber
        
        // 检查是否完成拼图
        if (this.puzzlePieces.every(piece => piece.placed)) {
          this.completeGame(2, "太棒了！0528日期拼图完成，我们的纪念日！💕")
        }
      } else {
        // 拖拽到错误位置
        this.incrementAttempts(2)
        if (this.shouldAutoPass(2)) {
          // 自动完成拼图
          this.puzzlePieces.forEach((piece, index) => {
            piece.placed = true
            piece.number = this.puzzleTargetNumbers[index]
          })
          setTimeout(() => {
            this.completeGame(2, "太棒了！0528日期拼图完成，我们的纪念日！💕（系统自动帮助通过）")
          }, 500)
        } else {
          // 显示错误提示
          const correctPosition = this.puzzleTargetNumbers.indexOf(pieceNumber) + 1
          alert(`数字${pieceNumber}应该放到第${correctPosition}位哦！再试试看～`)
        }
      }
    },
    
    // 游戏3: 情话配对
    shuffleQuotes() {
      this.shuffledSecondParts = [...this.loveQuotes].sort(() => Math.random() - 0.5)
    },
    
    selectLeft(index) {
      this.selectedLeft = index
      this.checkQuoteMatch()
    },
    
    selectRight(index) {
      this.selectedRight = index
      this.checkQuoteMatch()
    },
    
    checkQuoteMatch() {
      if (this.selectedLeft >= 0 && this.selectedRight >= 0) {
        const leftQuote = this.loveQuotes[this.selectedLeft]
        const rightQuote = this.shuffledSecondParts[this.selectedRight]
        
        if (leftQuote.second === rightQuote.second) {
          leftQuote.matched = true
          this.secondPartsMatched[this.selectedRight] = true
          
          if (this.loveQuotes.every(q => q.matched)) {
            this.completeGame(3, "完美！情话配对成功！你懂我的心💕")
          }
        }
        
        this.selectedLeft = -1
        this.selectedRight = -1
      }
    },
    
    // 游戏4: 日期记忆
    selectYear(year) {
      // 防止游戏已完成后继续点击
      if (this.completedGames.includes(4)) {
        return
      }
      
      // 如果尝试次数已经超过限制，直接完成游戏
      if (this.getGameAttempts(4) >= this.getMaxAttempts(4)) {
        this.completeGame(4, "答对了！2012年我们相识，那是最美好的开始！💕（系统自动帮助通过）")
        return
      }
      
      if (year === this.correctYear) {
        this.completeGame(4, "答对了！2012年我们相识，那是最美好的开始！💕")
      } else {
        this.incrementAttempts(4)
        if (this.shouldAutoPass(4)) {
          setTimeout(() => {
            this.completeGame(4, "答对了！2012年我们相识，那是最美好的开始！💕（系统自动帮助通过）")
          }, 500)
        } else {
          // 显示错误提示
          alert(`不对哦，再想想我们是哪一年相遇的～ (${this.getGameAttempts(4)}/${this.getMaxAttempts(4)})`)
        }
      }
    },
    
    // 游戏5: 记忆卡片
    initMemoryCards() {
      const emojis = ['💕', '🌹', '💍', '🎵', '💕', '🌹', '💍', '🎵']
      this.memoryCards = emojis.map(emoji => ({
        emoji,
        flipped: false,
        matched: false
      })).sort(() => Math.random() - 0.5)
    },
    
    flipCard(index) {
      if (this.memoryCards[index].flipped || this.memoryCards[index].matched) return
      
      this.memoryCards[index].flipped = true
      this.flippedCards.push(index)
      
      if (this.flippedCards.length === 2) {
        setTimeout(() => {
          this.checkMemoryMatch()
        }, 500)
      }
    },
    
    checkMemoryMatch() {
      const [first, second] = this.flippedCards
      if (this.memoryCards[first].emoji === this.memoryCards[second].emoji) {
        this.memoryCards[first].matched = true
        this.memoryCards[second].matched = true
        
        if (this.memoryCards.every(card => card.matched)) {
          this.completeGame(5, "记忆力超棒！找到了所有配对！💕")
        }
      } else {
        this.memoryCards[first].flipped = false
        this.memoryCards[second].flipped = false
      }
      this.flippedCards = []
    },
    
    // 游戏6: 字母游戏
    selectLetter(letter) {
      this.selectedLetters.push(letter)
      if (this.selectedLetters.join('') === this.targetWord) {
        this.completeGame(6, "LOVE！你拼出了我想说的话！💕")
      } else if (this.selectedLetters.length === 4) {
        this.incrementAttempts(6)
        if (this.shouldAutoPass(6)) {
          this.selectedLetters = ['L', 'O', 'V', 'E']
          setTimeout(() => {
            this.completeGame(6, "LOVE！你拼出了我想说的话！💕（系统自动帮助通过）")
          }, 500)
        } else {
          this.selectedLetters = []
        }
      }
    },
    
    // 游戏7: 颜色记忆
    startColorGame() {
      this.gameStarted = true
      this.colorSequence = []
      this.playerSequence = []
      
      // 生成5个随机颜色序列
      for (let i = 0; i < 5; i++) {
        this.colorSequence.push(Math.floor(Math.random() * 4))
      }
      
      this.showColorSequence()
    },
    
    showColorSequence() {
      this.sequenceShowing = true
      this.colorSequence.forEach((color, index) => {
        setTimeout(() => {
          this.activeColor = color
          setTimeout(() => {
            this.activeColor = -1
            if (index === this.colorSequence.length - 1) {
              this.sequenceShowing = false
            }
          }, 500)
        }, index * 1000)
      })
    },
    
    clickColor(colorIndex) {
      if (this.sequenceShowing) return
      
      this.playerSequence.push(colorIndex)
      
      if (this.playerSequence.length === this.colorSequence.length) {
        if (JSON.stringify(this.playerSequence) === JSON.stringify(this.colorSequence)) {
          this.completeGame(7, "颜色记忆完美！你的记忆力真棒！💕")
        } else {
          // 失败时重置游戏状态，让用户重新开始
          alert("顺序不对哦，再试试看！")
          this.gameStarted = false
          this.sequenceShowing = false
          this.playerSequence = []
          this.colorSequence = []
          this.activeColor = -1
        }
      }
    },
    
    // 游戏8: 时间轴排序
    shuffleTimelineEvents() {
      this.timelineEvents.sort(() => Math.random() - 0.5)
    },
    
    startTimelineDrag(index) {
      this.draggedEventIndex = index
    },
    
    dropTimelineEvent(targetIndex) {
      if (this.draggedEventIndex !== -1) {
        const draggedEvent = this.timelineEvents[this.draggedEventIndex]
        this.timelineEvents.splice(this.draggedEventIndex, 1)
        this.timelineEvents.splice(targetIndex, 0, draggedEvent)
        this.draggedEventIndex = -1
      }
    },
    
    checkTimelineOrder() {
      const isCorrect = this.timelineEvents.every((event, index) => event.order === index + 1)
      if (isCorrect) {
        this.completeGame(8, "时间轴排序正确！你记得我们的每个重要时刻！💕")
      }
    },
    
    // 游戏9: 找茬
    foundDifference(diffId) {
      const diff = this.differences.find(d => d.id === diffId)
      if (diff && !diff.found) {
        diff.found = true
        alert(`找到了！${diff.description} ✅`)
        
        if (this.differences.every(d => d.found)) {
          setTimeout(() => {
            this.completeGame(9, "火眼金睛！所有不同之处都被你找到了！💕")
          }, 500)
        }
      }
    },
    
    // 游戏10: 密码锁
    inputPassword(num) {
      // 防止游戏已完成后继续输入
      if (this.completedGames.includes(10)) {
        return
      }
      
      // 找到第一个空位并创建新数组确保响应性
      const newPassword = [...this.passwordInput]
      for (let i = 0; i < newPassword.length; i++) {
        if (newPassword[i] === '') {
          newPassword[i] = num.toString()
          this.passwordInput = newPassword
          
          // 如果是最后一位，延迟检查密码让用户看到输入
          if (i === newPassword.length - 1) {
            setTimeout(() => {
              this.checkPassword()
            }, 500)
          }
          break
        }
      }
    },
    
    clearPassword() {
      // 防止游戏已完成后清除
      if (this.completedGames.includes(10)) {
        return
      }
      
      // 创建新数组确保响应性
      this.passwordInput = ['', '', '']
    },
    
    checkPassword() {
      if (JSON.stringify(this.passwordInput) === JSON.stringify(this.correctPassword)) {
        this.completeGame(10, "密码正确！520，我想静文念得数字！💕")
      } else {
        this.incrementAttempts(10)
        if (this.shouldAutoPass(10)) {
          this.passwordInput = ['5', '2', '0']
          setTimeout(() => {
            this.completeGame(10, "密码正确！520，我想静文念得数字！💕（系统自动帮助通过）")
          }, 500)
        } else {
          setTimeout(() => {
            this.clearPassword()
          }, 1000)
        }
      }
    },
    
    // 游戏11: 音乐节拍
    startRhythmGame() {
      this.rhythmGameStarted = true
      this.beatInterval = setInterval(() => {
        this.beatActive = true
        setTimeout(() => {
          this.beatActive = false
        }, 200)
      }, 800)
      
      // 监听点击
      document.addEventListener('click', this.handleBeatClick)
    },
    
    handleBeatClick() {
      if (this.beatActive) {
        this.beatCount++
        if (this.beatCount === 13) {
          clearInterval(this.beatInterval)
          document.removeEventListener('click', this.handleBeatClick)
          this.completeGame(11, "节拍完美！13下代表我们13年的爱情！💕")
        }
      }
    },
    
    // 游戏12: 星座连线
    clickStar(index) {
      this.stars[index].connected = !this.stars[index].connected
      
      if (this.stars.every(star => star.connected)) {
        // 当所有星星都点亮后，画出爱心连线
        this.drawHeartLines()
        setTimeout(() => {
          this.completeGame(12, "星星连线成功！组成了爱的形状！💕")
        }, 1000)
      }
    },
    
    drawHeartLines() {
      // 画出爱心形状的连线
      const heartPaths = [
        // 左边心形
        `M ${this.stars[0].x} ${this.stars[0].y} Q ${this.stars[1].x-10} ${this.stars[1].y-10} ${this.stars[3].x} ${this.stars[3].y}`,
        // 右边心形
        `M ${this.stars[2].x} ${this.stars[2].y} Q ${this.stars[1].x+10} ${this.stars[1].y-10} ${this.stars[4].x} ${this.stars[4].y}`,
        // 底部连接
        `M ${this.stars[3].x} ${this.stars[3].y} L ${this.stars[1].x} ${this.stars[1].y+30} L ${this.stars[4].x} ${this.stars[4].y}`
      ]
      
      this.starLines = heartPaths
    },
    
    // 游戏13: 最终告白
    checkConfession() {
      // 无论输入什么都通过游戏
      if (this.confessionInput.trim() !== '') {
        this.completeGame(13, "谢谢你的回答！这份爱的礼物就是为你准备的！💕")
      } else {
        alert("请输入您的想法～")
      }
    },
    
    // 转账相关方法
    openAlipayTransfer() {
      // 检查是否已设置收款人账号
      if (!this.recipientAlipayId) {
        alert('⚠️ 重要提醒：\n\n请先在代码中设置收款人的支付宝账号！\n在 recipientAlipayId 字段填入女友的支付宝账号或手机号。\n\n为了安全起见，不建议在代码中直接硬编码敏感信息。')
        this.showTransferDetails = true
        return
      }
      
      const amount = this.transferAmount
      const memo = encodeURIComponent('十三年爱情游戏通关奖励💕')
      
      // 如果是移动设备，尝试打开支付宝应用
      if (this.isMobile()) {
        // 使用支付宝转账链接
        const alipayUrl = `alipays://platformapi/startapp?appId=09999988&actionType=scan&biz_data={"s":"money","u":"${this.recipientAlipayId}","a":"${amount}","m":"${memo}"}`
        
        try {
          window.location.href = alipayUrl
        } catch (error) {
          // 如果无法打开应用，显示转账信息
          this.showManualTransferGuide()
        }
      } else {
        // 桌面端显示转账指南
        this.showManualTransferGuide()
      }
    },
    
    showManualTransferGuide() {
      alert(`💰 转账信息：\n\n收款人：${this.recipientName}\n金额：¥${this.transferAmount}\n备注：十三年爱情游戏通关奖励💕\n\n请手动打开支付宝进行转账～`)
      this.showTransferDetails = true
    },
    
    showTransferInfo() {
      this.showTransferDetails = !this.showTransferDetails
    },
    
    isMobile() {
      return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)
    },
    
    copyTransferInfo() {
      const transferInfo = `收款人：${this.recipientName}\n金额：¥${this.transferAmount}\n备注：十三年爱情游戏通关奖励💕`
      
      if (navigator.clipboard) {
        navigator.clipboard.writeText(transferInfo).then(() => {
          alert('转账信息已复制到剪贴板！')
        })
      } else {
        // 降级方案
        const textArea = document.createElement('textarea')
        textArea.value = transferInfo
        document.body.appendChild(textArea)
        textArea.select()
        document.execCommand('copy')
        document.body.removeChild(textArea)
        alert('转账信息已复制到剪贴板！')
      }
    },
    
    // 通用方法
    completeGame(gameNumber, message) {
      if (!this.completedGames.includes(gameNumber)) {
        this.completedGames.push(gameNumber)
        alert(message)
      }
    },
    
    forceCompleteCurrentGame() {
      const gameMessages = {
        1: "太棒了！31号正是我们在一起的日子！💕",
        2: "太棒了！0528日期拼图完成，我们的纪念日！💕",
        3: "完美！情话配对成功！你懂我的心💕",
        4: "答对了！2012年我们相识，那是最美好的开始！💕",
        5: "记忆力超棒！找到了所有配对！💕",
        6: "LOVE！你拼出了我想说的话！💕",
        7: "颜色记忆完美！你的记忆力真棒！💕",
        8: "时间轴排序正确！你记得我们的每个重要时刻！💕",
        9: "火眼金睛！所有不同之处都被你找到了！💕",
        10: "密码正确！520，我想静文念得数字！💕",
        11: "节拍完美！13下代表我们13年的爱情！💕",
        12: "星星连线成功！组成了爱的形状！💕",
        13: "谢谢你的回答！这份爱的礼物就是为你准备的！💕"
      }
      
      const message = gameMessages[this.currentGame] + "（紧急修复通过）"
      this.completeGame(this.currentGame, message)
    },
    
    nextGame() {
      if (this.currentGame < 13) {
        this.currentGame++
        
        // 重置各个游戏的状态
        if (this.currentGame === 1) {
          // 重置第一关状态
          this.isFlashing = false
          this.isBlurry = false
          this.numberOpacity = 1
          this.numberScale = 1
          this.numberShake = 0
          this.currentNumber = 0
          if (this.flashInterval) clearInterval(this.flashInterval)
          if (this.effectInterval) clearInterval(this.effectInterval)
          // 不自动开始，让用户点击开始按钮
        } else if (this.currentGame === 2) {
          // 重置拼图游戏
          this.puzzlePieces = [
            {placed: false, number: null},
            {placed: false, number: null},
            {placed: false, number: null},
            {placed: false, number: null}
          ]
          // 每次重新洗牌
          this.shufflePuzzlePieces()
        } else if (this.currentGame === 3) {
          // 重置情话配对游戏
          this.loveQuotes.forEach(quote => quote.matched = false)
          this.secondPartsMatched = [false, false, false]
          this.selectedLeft = -1
          this.selectedRight = -1
          this.shuffleQuotes()
        } else if (this.currentGame === 5) {
          // 重置记忆卡片游戏
          this.initMemoryCards()
          this.flippedCards = []
        } else if (this.currentGame === 6) {
          // 重置字母游戏
          this.selectedLetters = []
        } else if (this.currentGame === 7) {
          // 重置颜色记忆游戏
          this.gameStarted = false
          this.sequenceShowing = false
          this.colorSequence = []
          this.playerSequence = []
          this.activeColor = -1
        } else if (this.currentGame === 8) {
          // 重置时间轴游戏
          this.shuffleTimelineEvents()
        } else if (this.currentGame === 9) {
          // 重置找茬游戏
          this.differences.forEach(diff => diff.found = false)
        } else if (this.currentGame === 10) {
          // 重置密码游戏
          this.passwordInput = ['', '', '']
        } else if (this.currentGame === 11) {
          // 重置音乐节拍游戏
          this.rhythmGameStarted = false
          this.beatCount = 0
          this.beatActive = false
          if (this.beatInterval) {
            clearInterval(this.beatInterval)
            this.beatInterval = null
          }
          document.removeEventListener('click', this.handleBeatClick)
        } else if (this.currentGame === 12) {
          // 重置星座连线游戏
          this.stars.forEach(star => star.connected = false)
          this.starLines = []
          this.currentPath = ''
          this.connectingStars = false
        } else if (this.currentGame === 13) {
          // 重置最终告白游戏
          this.confessionInput = ''
        }
      }
    }
  }
}
</script>

<style scoped>
.love-games-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.games-container {
  background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
  border-radius: 20px;
  padding: 2rem;
  max-width: 600px;
  max-height: 80vh;
  overflow-y: auto;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
}

.game-header {
  text-align: center;
  margin-bottom: 2rem;
}

.game-header h2 {
  color: #fff;
  margin-bottom: 1rem;
}

.debug-controls {
  margin-top: 1rem;
}

.emergency-btn {
  background: #ff4444;
  color: white;
  border: none;
  padding: 0.5rem 1rem;
  border-radius: 5px;
  cursor: pointer;
  font-size: 0.9rem;
  transition: all 0.3s ease;
}

.emergency-btn:hover {
  background: #ff2222;
  transform: scale(1.05);
}

.progress-bar {
  width: 100%;
  height: 10px;
  background: rgba(255, 255, 255, 0.3);
  border-radius: 5px;
  overflow: hidden;
  margin: 1rem 0;
}

.progress {
  height: 100%;
  background: linear-gradient(90deg, #ff6b6b, #4ecdc4);
  transition: width 0.3s ease;
}

.game-content {
  background: rgba(255, 255, 255, 0.9);
  padding: 2rem;
  border-radius: 15px;
  margin-bottom: 1rem;
  text-align: center;
}

.game-content h3 {
  color: #333;
  margin-bottom: 1rem;
}

/* 游戏1: 数字转盘 */
.number-wheel {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1rem;
}

.wheel {
  width: 120px;
  height: 120px;
  border: 4px solid #ff6b6b;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  font-weight: bold;
  color: #333;
  background: #fff;
}

.wheel.spinning {
  animation: spin 0.1s linear infinite;
}

.number.changing {
  color: #ff6b6b;
  font-weight: bold;
  text-shadow: 0 0 10px rgba(255, 107, 107, 0.5);
  transform: scale(1.2);
  transition: all 0.1s ease;
}

.attempt-hint {
  margin-top: 1rem;
  color: #ffa502;
  font-weight: bold;
  text-align: center;
}

.success-hint {
  margin-top: 1rem;
  color: #27ae60;
  font-weight: bold;
  text-align: center;
  background: rgba(39, 174, 96, 0.1);
  padding: 0.5rem;
  border-radius: 5px;
  border: 1px solid rgba(39, 174, 96, 0.3);
}

/* 游戏2: 拼图 */
.puzzle-area {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  align-items: center;
}

.puzzle-target {
  display: grid;
  grid-template-columns: repeat(2, 100px);
  grid-template-rows: repeat(2, 100px);
  gap: 8px;
  justify-content: center;
  margin-bottom: 1rem;
}

.puzzle-slot {
  width: 100px;
  height: 100px;
  border: 3px dashed #ff6b6b;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  border-radius: 10px;
  background: rgba(255, 255, 255, 0.1);
  transition: all 0.3s ease;
}

.puzzle-slot:hover {
  border-color: #4ecdc4;
  background: rgba(78, 205, 196, 0.1);
}

.slot-hint {
  color: #ccc;
  font-size: 2rem;
  font-weight: bold;
}

.puzzle-pieces {
  display: flex;
  gap: 1rem;
  justify-content: center;
  margin-bottom: 1rem;
}

.puzzle-piece {
  width: 80px;
  height: 80px;
  background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
  color: white;
  border: 2px solid #ff6b6b;
  border-radius: 10px;
  cursor: grab;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  font-weight: bold;
  transition: all 0.3s ease;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.puzzle-piece:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
}

.puzzle-piece:active {
  cursor: grabbing;
  transform: scale(0.95);
}

.puzzle-piece.placed {
  background: linear-gradient(135deg, #4ecdc4, #44a08d);
  border-color: #4ecdc4;
}

.puzzle-hint {
  text-align: center;
  color: #666;
  font-size: 0.9rem;
  margin-top: 0.5rem;
  padding: 0.5rem;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 5px;
}

/* 游戏3: 情话配对 */
.love-quotes-game {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
}

.quote-item {
  padding: 1rem;
  background: #fff;
  border: 2px solid #ddd;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.quote-item.selected {
  border-color: #ff6b6b;
  background: #ffe6e6;
}

.quote-item.matched {
  background: #e6ffe6;
  border-color: #4ecdc4;
}

/* 游戏4: 日期选择 */
.date-options {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1rem;
}

.date-btn {
  padding: 1rem;
  background: #fff;
  border: 2px solid #ff6b6b;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.date-btn:hover:not(:disabled) {
  background: #ff6b6b;
  color: white;
}

.date-btn:disabled {
  background: #ccc;
  color: #666;
  cursor: not-allowed;
}

.date-btn.correct {
  background: #4ecdc4;
  color: white;
  border-color: #4ecdc4;
}

.success-hint {
  margin-top: 1rem;
  color: #4ecdc4;
  font-weight: bold;
  text-align: center;
  padding: 0.5rem;
  background: rgba(78, 205, 196, 0.1);
  border-radius: 5px;
}

/* 游戏5: 记忆卡片 */
.memory-game {
  display: grid;
  grid-template-columns: repeat(4, 80px);
  gap: 10px;
  justify-content: center;
}

.memory-card {
  width: 80px;
  height: 80px;
  perspective: 1000px;
  cursor: pointer;
}

.card-front, .card-back {
  position: absolute;
  width: 100%;
  height: 100%;
  backface-visibility: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 10px;
  font-size: 1.5rem;
}

.card-front {
  background: #ff6b6b;
  color: white;
}

.card-back {
  background: #4ecdc4;
  color: white;
  transform: rotateY(180deg);
}

.memory-card.flipped .card-front {
  transform: rotateY(180deg);
}

.memory-card.flipped .card-back {
  transform: rotateY(0deg);
}

/* 游戏6: 字母游戏 */
.letter-game {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  align-items: center;
}

.target-word {
  font-size: 2rem;
  font-weight: bold;
  color: #ff6b6b;
}

.letter-buttons {
  display: flex;
  gap: 1rem;
}

.letter-btn {
  width: 60px;
  height: 60px;
  background: #fff;
  border: 2px solid #ff6b6b;
  border-radius: 10px;
  font-size: 1.5rem;
  cursor: pointer;
}

.letter-btn:disabled {
  background: #ccc;
  cursor: not-allowed;
}

/* 游戏7: 颜色记忆 */
.color-game {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  align-items: center;
}

.color-buttons {
  display: grid;
  grid-template-columns: repeat(2, 80px);
  gap: 10px;
}

.color-btn {
  width: 80px;
  height: 80px;
  border: 3px solid #fff;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.color-btn.active {
  border-color: #333;
  transform: scale(1.1);
}

/* 游戏8: 时间轴 */
.timeline-events {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  margin-bottom: 1rem;
}

.timeline-event {
  padding: 1rem;
  background: #fff;
  border: 2px solid #ddd;
  border-radius: 10px;
  cursor: grab;
}

/* 游戏9: 找茬 */
.image-pair {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
}

.game-image {
  position: relative;
  width: 200px;
  height: 150px;
  background: #f0f0f0;
  border: 2px solid #ddd;
  display: flex;
  align-items: center;
  justify-content: center;
}

.difference-spot {
  position: absolute;
  width: 20px;
  height: 20px;
  border: 2px solid red;
  border-radius: 50%;
  cursor: pointer;
}

.difference-spot.found {
  background: rgba(255, 0, 0, 0.3);
}

/* 游戏10: 密码锁 */
.password-debug {
  background: rgba(255, 215, 0, 0.1);
  border: 1px dashed #ffd700;
  padding: 0.5rem;
  margin: 0.5rem 0;
  border-radius: 5px;
  font-size: 0.9rem;
  color: #ff6b6b;
  font-weight: bold;
  text-align: center;
}

.password-display {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 1rem;
  justify-content: center;
}

.password-digit {
  width: 40px;
  height: 40px;
  border: 2px solid #ccc;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  background: #fff;
}

.number-pad {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 0.5rem;
  max-width: 300px;
}

.number-btn, .clear-btn {
  padding: 1rem;
  background: #fff;
  border: 2px solid #ff6b6b;
  border-radius: 5px;
  cursor: pointer;
}

/* 游戏11: 节拍游戏 */
.rhythm-game {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  align-items: center;
}

.beat-circle {
  width: 120px;
  height: 120px;
  border: 4px solid #ccc;
  border-radius: 50%;
  transition: all 0.2s ease;
}

.beat-circle.active {
  border-color: #ff6b6b;
  background: rgba(255, 107, 107, 0.2);
  transform: scale(1.1);
}

/* 游戏12: 星座连线 */
.star-canvas {
  width: 300px;
  height: 200px;
  background: #000;
  border-radius: 10px;
}

.star {
  fill: #ffd700;
  cursor: pointer;
}

.star.connected {
  fill: #ff69b4;
}

/* 游戏13: 告白 */
.confession-game {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  align-items: center;
}

.confession-input {
  padding: 1rem;
  border: 2px solid #ff6b6b;
  border-radius: 10px;
  font-size: 1rem;
  width: 200px;
  text-align: center;
}

/* 完成庆祝 */
.completion-celebration {
  text-align: center;
  padding: 2rem;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-radius: 15px;
}

/* 转账功能样式 */
.transfer-section {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 15px;
  padding: 2rem;
  margin: 2rem 0;
  backdrop-filter: blur(10px);
}

.transfer-amount {
  font-size: 2.5rem;
  font-weight: bold;
  color: #ffd700;
  margin: 1rem 0;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

.transfer-buttons {
  display: flex;
  gap: 1rem;
  justify-content: center;
  margin: 1.5rem 0;
  flex-wrap: wrap;
}

.transfer-btn {
  padding: 1rem 2rem;
  border: none;
  border-radius: 25px;
  cursor: pointer;
  font-weight: bold;
  font-size: 1rem;
  transition: all 0.3s ease;
  min-width: 150px;
}

.alipay-btn {
  background: linear-gradient(135deg, #1677ff 0%, #69c0ff 100%);
  color: white;
}

.info-btn {
  background: linear-gradient(135deg, #52c41a 0%, #95f985 100%);
  color: white;
}

.copy-btn {
  background: linear-gradient(135deg, #fa8c16 0%, #ffd666 100%);
  color: white;
}

.transfer-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
}

.transfer-details {
  background: rgba(255, 255, 255, 0.15);
  border-radius: 10px;
  padding: 1.5rem;
  margin-top: 1rem;
  text-align: left;
}

.transfer-info {
  background: rgba(255, 255, 255, 0.9);
  color: #333;
  padding: 1rem;
  border-radius: 8px;
  margin: 1rem 0;
}

.transfer-info p {
  margin: 0.5rem 0;
}

.transfer-actions {
  margin-top: 1rem;
}

.transfer-notes {
  background: rgba(255, 255, 255, 0.1);
  padding: 1rem;
  border-radius: 8px;
  margin-top: 1rem;
}

.transfer-notes p {
  margin: 0.3rem 0;
  font-size: 0.9rem;
}

.celebration-hearts {
  margin-top: 1rem;
}

.floating-heart {
  display: inline-block;
  animation: float 3s ease-in-out infinite;
  margin: 0 0.2rem;
}

.floating-heart:nth-child(even) {
  animation-delay: 1s;
}

/* 控制按钮 */
.game-controls {
  display: flex;
  gap: 1rem;
  justify-content: center;
  margin-top: 1rem;
}

.game-btn, .next-btn, .close-btn {
  padding: 0.8rem 1.5rem;
  border: none;
  border-radius: 25px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.3s ease;
}

.game-btn, .next-btn {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.close-btn {
  background: #ff6b6b;
  color: white;
}

.game-btn:hover, .next-btn:hover, .close-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

.next-btn:disabled {
  background: #ccc;
  cursor: not-allowed;
  transform: none;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-10px); }
}

/* 响应式设计 */
@media (max-width: 768px) {
  .games-container {
    margin: 1rem;
    padding: 1rem;
    max-height: 90vh;
  }
  
  .game-content {
    padding: 1rem;
  }
  
  .love-quotes-game {
    grid-template-columns: 1fr;
  }
  
  .image-pair {
    grid-template-columns: 1fr;
  }
  
  .game-image {
    width: 100%;
    max-width: 250px;
  }
}
</style> 